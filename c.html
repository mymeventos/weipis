<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sueldos y Precios - c</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }
        h1, h2, h3 {
            color: #333;
        }
        .container {
            display: grid;
            gap: 20px;
            grid-template-columns: 1fr;
        }
        @media (min-width: 768px) {
            .container {
                grid-template-columns: 1fr 1fr;
            }
        }
        .panel {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .form-section {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .form-section input, .form-section select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            flex: 1;
            min-width: 150px;
        }
        .form-section button {
            padding: 8px 12px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .form-section button:hover {
            background-color: #218838;
        }
        .delete-btn {
            background: none;
            border: none;
            cursor: pointer;
        }
        .editable {
            cursor: pointer;
            border: 1px dashed #ccc;
        }
        .edit-input {
            width: 100%;
            box-sizing: border-box;
            border: none;
            background: none;
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
</head>
<body>

    <h1>Administración de Datos</h1>
    <div class="container">
        <div class="panel" id="gastos-pasteleria">
            <h2>Gastos de Pastelería</h2>
            <div class="form-section">
                <input type="text" id="gasto-nombre" placeholder="Nombre">
                <input type="number" id="gasto-monto" step="0.01" placeholder="Monto">
                <button onclick="agregarGasto()">Agregar Gasto</button>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Monto</th>
                        <th style="width: 40px;"></th>
                    </tr>
                </thead>
                <tbody id="gastos-list">
                    </tbody>
                <tfoot>
                    <tr>
                        <td style="text-align: right; font-weight: bold;">TOTAL:</td>
                        <td style="font-weight: bold;" id="total-gastos"></td>
                        <td></td>
                    </tr>
                </tfoot>
            </table>
        </div>

        <div class="panel" id="precios-pasteleria">
            <h2>Precios de Productos</h2>
            <div class="form-section">
                <input type="text" id="precio-nombre" placeholder="Nombre del Producto">
                <input type="number" id="precio-monto" step="0.01" placeholder="Precio">
                <button onclick="agregarPrecio()">Agregar Precio</button>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Producto</th>
                        <th>Precio</th>
                        <th style="width: 40px;"></th>
                    </tr>
                </thead>
                <tbody id="precios-list">
                    </tbody>
            </table>
        </div>

        <div class="panel" id="ingresos-pasteleria">
            <h2>Ingresos</h2>
            <div class="form-section">
                <input type="text" id="ingreso-nombre" placeholder="Nombre">
                <input type="number" id="ingreso-monto" step="0.01" placeholder="Monto">
                <button onclick="agregarIngreso()">Agregar Ingreso</button>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Monto</th>
                        <th style="width: 40px;"></th>
                    </tr>
                </thead>
                <tbody id="ingresos-list">
                    </tbody>
                <tfoot>
                    <tr>
                        <td style="text-align: right; font-weight: bold;">TOTAL:</td>
                        <td style="font-weight: bold;" id="total-ingresos"></td>
                        <td></td>
                    </tr>
                </tfoot>
            </table>
        </div>

        <div class="panel" id="ventas-pasteleria">
            <h3>Ventas</h3>
            <div class="form-section">
                <input type="date" id="venta-fecha-ventas-pasteleria" placeholder="Fecha">
                <select id="venta-tipo-ventas-pasteleria">
                    <option value="DIATORTAS">Día de la Torta</option>
                    <option value="MESADULCE">Mesa Dulce</option>
                    <option value="CELIACO">Celíaco</option>
                </select>
                <input type="number" id="venta-cantidad-ventas-pasteleria" step="0.01" placeholder="Cantidad">
                <button onclick="agregarVenta('ventas-pasteleria')">Agregar Venta</button>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Tipo</th>
                        <th>Cantidad</th>
                        <th>Precio Unidad</th>
                        <th>Total Venta</th>
                        <th style="width: 40px;"></th>
                    </tr>
                </thead>
                <tbody id="ventas-list-ventas-pasteleria">
                    </tbody>
                <tfoot>
                    <tr>
                        <td colspan="4" style="text-align: right; font-weight: bold;">TOTAL DEL MES:</td>
                        <td style="font-weight: bold;" id="total-ventas-ventas-pasteleria"></td>
                        <td></td>
                    </tr>
                </tfoot>
            </table>
        </div>
        
        <div class="panel" id="sueldos">
            <h2>Sueldos</h2>
            <div class="form-section">
                <input type="text" id="sueldo-nombre" placeholder="Nombre">
                <input type="number" id="sueldo-monto" step="0.01" placeholder="Sueldo">
                <button onclick="agregarSueldo()">Agregar Sueldo</button>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Sueldo ($)</th>
                        <th>Inflación (%)</th>
                        <th>Sueldo Ajustado ($)</th>
                        <th style="width: 40px;"></th>
                    </tr>
                </thead>
                <tbody id="sueldos-list">
                    </tbody>
                <tfoot>
                    <tr>
                        <td colspan="3" style="text-align: right; font-weight: bold;">TOTAL:</td>
                        <td style="font-weight: bold;" id="total-sueldos"></td>
                        <td></td>
                    </tr>
                </tfoot>
            </table>
        </div>
        
        <div class="panel" id="inflacion">
            <h2>Inflación</h2>
            <div class="form-section">
                <input type="text" id="inflacion-mes" placeholder="Mes (ej. Enero)">
                <input type="number" id="inflacion-porcentaje" step="0.01" placeholder="Porcentaje (%)">
                <button onclick="agregarInflacion()">Agregar Inflación</button>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Mes</th>
                        <th>Porcentaje (%)</th>
                        <th style="width: 40px;"></th>
                    </tr>
                </thead>
                <tbody id="inflacion-list">
                    </tbody>
            </table>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "TU_API_KEY",
            authDomain: "TU_AUTH_DOMAIN",
            projectId: "TU_PROJECT_ID",
            storageBucket: "TU_STORAGE_BUCKET",
            messagingSenderId: "TU_MESSAGING_SENDER_ID",
            appId: "TU_APP_ID"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let sueldosPorNombre = {};
        let inflacionPorMes = {};
        let preciosPasteleriaPorMes = {};

        function formatCurrency(amount) {
            return `$${(amount || 0).toFixed(2)}`;
        }

        // --- Funciones para Gastos, Precios e Ingresos ---
        // Estas funciones se mantuvieron sin cambios
        
        async function agregarGasto() {
            const nombre = document.getElementById('gasto-nombre').value;
            const monto = parseFloat(document.getElementById('gasto-monto').value);
            if (nombre && !isNaN(monto)) {
                await db.collection('gastos').add({
                    nombre: nombre,
                    monto: monto,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                document.getElementById('gasto-nombre').value = '';
                document.getElementById('gasto-monto').value = '';
            }
        }
        
        async function agregarPrecio() {
            const nombre = document.getElementById('precio-nombre').value.toUpperCase();
            const monto = parseFloat(document.getElementById('precio-monto').value);
            if (nombre && !isNaN(monto)) {
                await db.collection('preciosPasteleria').doc(nombre).set({
                    precio: monto
                });
                document.getElementById('precio-nombre').value = '';
                document.getElementById('precio-monto').value = '';
            }
        }

        async function agregarIngreso() {
            const nombre = document.getElementById('ingreso-nombre').value;
            const monto = parseFloat(document.getElementById('ingreso-monto').value);
            if (nombre && !isNaN(monto)) {
                await db.collection('ingresos').add({
                    nombre: nombre,
                    monto: monto,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                document.getElementById('ingreso-nombre').value = '';
                document.getElementById('ingreso-monto').value = '';
            }
        }

        // --- Funciones para Sueldos e Inflación ---
        // Se agregaron los listeners para los cambios en sueldos e inflación
        
        async function agregarSueldo() {
            const nombre = document.getElementById('sueldo-nombre').value;
            const monto = parseFloat(document.getElementById('sueldo-monto').value);
            if (nombre && !isNaN(monto)) {
                await db.collection('sueldos').add({
                    nombre: nombre,
                    monto: monto
                });
                document.getElementById('sueldo-nombre').value = '';
                document.getElementById('sueldo-monto').value = '';
            }
        }

        function renderizarSueldos() {
            const sueldosList = document.getElementById('sueldos-list');
            sueldosList.innerHTML = '';
            let totalSueldos = 0;
            
            for (const id in sueldosPorNombre) {
                const sueldo = sueldosPorNombre[id];
                const inflacion = inflacionPorMes[sueldo.nombre] || 0;
                const sueldoAjustado = sueldo.monto * (1 + (inflacion / 100));
                totalSueldos += sueldoAjustado;
                
                const row = document.createElement('tr');
                row.dataset.id = id;
                row.innerHTML = `
                    <td class="editable" data-field="nombre" data-id="${id}">${sueldo.nombre}</td>
                    <td class="editable" data-field="monto" data-id="${id}">${formatCurrency(sueldo.monto)}</td>
                    <td class="editable" data-field="inflacion" data-id="${id}">${inflacion.toFixed(2)}%</td>
                    <td>${formatCurrency(sueldoAjustado)}</td>
                    <td><button class="delete-btn" onclick="eliminarSueldo('${id}')">❌</button></td>
                `;
                sueldosList.appendChild(row);
            }
            document.getElementById('total-sueldos').textContent = formatCurrency(totalSueldos);
        }

        async function agregarInflacion() {
            const mes = document.getElementById('inflacion-mes').value;
            const porcentaje = parseFloat(document.getElementById('inflacion-porcentaje').value);
            if (mes && !isNaN(porcentaje)) {
                await db.collection('inflacion').doc(mes).set({ porcentaje: porcentaje });
                document.getElementById('inflacion-mes').value = '';
                document.getElementById('inflacion-porcentaje').value = '';
            }
        }
        
        function renderizarInflacion() {
            const inflacionList = document.getElementById('inflacion-list');
            inflacionList.innerHTML = '';
            for (const mes in inflacionPorMes) {
                const porcentaje = inflacionPorMes[mes];
                const row = document.createElement('tr');
                row.dataset.id = mes;
                row.innerHTML = `
                    <td class="editable" data-field="mes">${mes}</td>
                    <td class="editable" data-field="porcentaje">${porcentaje.toFixed(2)}%</td>
                    <td><button class="delete-btn" onclick="eliminarInflacion('${mes}')">❌</button></td>
                `;
                inflacionList.appendChild(row);
            }
        }

        // --- Funciones para Ventas ---
        // Se cambió la función renderizarVentas para mostrar los precios
        
        async function agregarVenta(containerId) {
            const fecha = document.getElementById(`venta-fecha-${containerId}`).value;
            const tipo = document.getElementById(`venta-tipo-${containerId}`).value;
            const cantidad = parseFloat(document.getElementById(`venta-cantidad-${containerId}`).value);
            
            if (fecha && tipo && !isNaN(cantidad) && cantidad > 0) {
                const venta = {
                    fecha: fecha,
                    [tipo.toLowerCase()]: cantidad,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                };
                await db.collection('ventasPasteleria').add(venta);
                document.getElementById(`venta-fecha-${containerId}`).value = '';
                document.getElementById(`venta-cantidad-${containerId}`).value = '';
            }
        }
        
        function renderizarVentas(ventas, precios, containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
        
            container.innerHTML = `
                <h3>Ventas</h3>
                <div class="form-section">
                    <input type="date" id="venta-fecha-${containerId}" placeholder="Fecha">
                    <select id="venta-tipo-${containerId}">
                        <option value="DIATORTAS">Día de la Torta</option>
                        <option value="MESADULCE">Mesa Dulce</option>
                        <option value="CELIACO">Celíaco</option>
                    </select>
                    <input type="number" id="venta-cantidad-${containerId}" step="0.01" placeholder="Cantidad">
                    <button onclick="agregarVenta('${containerId}')">Agregar Venta</button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Tipo</th>
                            <th>Cantidad</th>
                            <th>Precio Unidad</th>
                            <th>Total Venta</th>
                            <th style="width: 40px;"></th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                    <tfoot>
                        <tr>
                            <td colspan="4" style="text-align: right; font-weight: bold;">TOTAL DEL MES:</td>
                            <td style="font-weight: bold;" id="total-ventas-${containerId}"></td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            `;
        
            const tbody = container.querySelector('tbody');
            let totalMes = 0;
            
            ventas.forEach(venta => {
                const row = document.createElement('tr');
                row.dataset.id = venta.id;
        
                const tipos = ['diatortas', 'mesadulce', 'celiaco'];
                tipos.forEach(tipo => {
                    if (venta[tipo] > 0) {
                        const precio = precios[tipo.toUpperCase()] || 0;
                        const total = venta[tipo] * precio;
                        totalMes += total;
                        const innerRow = document.createElement('tr');
                        innerRow.dataset.id = venta.id;
                        innerRow.innerHTML = `
                            <td>${venta.fecha}</td>
                            <td>${tipo === 'diatortas' ? 'Día de la Torta' : tipo === 'mesadulce' ? 'Mesa Dulce' : 'Celíaco'}</td>
                            <td class="editable" data-field="${tipo}" data-id="${venta.id}">${venta[tipo]}</td>
                            <td>${formatCurrency(precio)}</td>
                            <td>${formatCurrency(total)}</td>
                            <td><button class="delete-btn" data-id="${venta.id}" data-tipo="${tipo}">❌</button></td>
                        `;
                        tbody.appendChild(innerRow);
                    }
                });
            });
        
            document.getElementById(`total-ventas-${containerId}`).textContent = formatCurrency(totalMes);
        
            container.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', async function() {
                    const id = this.dataset.id;
                    if (confirm('¿Estás seguro de que deseas eliminar este registro?')) {
                        const docRef = doc(db, 'ventasPasteleria', id);
                        await deleteDoc(docRef);
                    }
                });
            });
        
            container.querySelectorAll('td.editable').forEach(cell => {
                cell.ondblclick = function() {
                    const id = this.dataset.id;
                    const field = this.dataset.field;
                    const valor = parseFloat(this.textContent) || 0;
                    
                    const input = document.createElement('input');
                    input.type = 'number';
                    input.className = 'edit-input';
                    input.value = valor;
                    input.step = "0.01";
                    
                    this.innerHTML = '';
                    this.appendChild(input);
                    
                    input.focus();
                    
                    input.onblur = async function() {
                        const nuevoValor = parseFloat(this.value) || 0;
                        const docRef = doc(db, 'ventasPasteleria', id);
                        await updateDoc(docRef, { [field]: nuevoValor });
                    };
                };
            });
        }

        // --- Listeners de Firebase ---
        // Estos listeners se encargan de actualizar la interfaz de usuario en tiempo real
        
        db.collection('gastos').onSnapshot(snapshot => {
            const gastosList = document.getElementById('gastos-list');
            gastosList.innerHTML = '';
            let total = 0;
            snapshot.forEach(doc => {
                const gasto = doc.data();
                const row = document.createElement('tr');
                row.innerHTML = `<td>${gasto.nombre}</td><td>${formatCurrency(gasto.monto)}</td><td><button class="delete-btn" onclick="eliminarDocumento('gastos', '${doc.id}')">❌</button></td>`;
                gastosList.appendChild(row);
                total += gasto.monto;
            });
            document.getElementById('total-gastos').textContent = formatCurrency(total);
        });

        db.collection('ingresos').onSnapshot(snapshot => {
            const ingresosList = document.getElementById('ingresos-list');
            ingresosList.innerHTML = '';
            let total = 0;
            snapshot.forEach(doc => {
                const ingreso = doc.data();
                const row = document.createElement('tr');
                row.innerHTML = `<td>${ingreso.nombre}</td><td>${formatCurrency(ingreso.monto)}</td><td><button class="delete-btn" onclick="eliminarDocumento('ingresos', '${doc.id}')">❌</button></td>`;
                ingresosList.appendChild(row);
                total += ingreso.monto;
            });
            document.getElementById('total-ingresos').textContent = formatCurrency(total);
        });
        
        db.collection('preciosPasteleria').onSnapshot(snapshot => {
            const preciosList = document.getElementById('precios-list');
            preciosList.innerHTML = '';
            preciosPasteleriaPorMes = {};
            snapshot.forEach(doc => {
                const precio = doc.data();
                preciosPasteleriaPorMes[doc.id] = precio.precio;
                const row = document.createElement('tr');
                row.innerHTML = `<td>${doc.id}</td><td class="editable" data-field="precio" data-id="${doc.id}">${formatCurrency(precio.precio)}</td><td><button class="delete-btn" onclick="eliminarDocumento('preciosPasteleria', '${doc.id}')">❌</button></td>`;
                preciosList.appendChild(row);
            });
            // Vuelve a renderizar las ventas con los precios actualizados
            db.collection('ventasPasteleria').orderBy('fecha').onSnapshot(ventasSnapshot => {
                const ventas = ventasSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderizarVentas(ventas, preciosPasteleriaPorMes, 'ventas-pasteleria');
            });
        });
        
        db.collection('sueldos').onSnapshot(snapshot => {
            sueldosPorNombre = {};
            snapshot.forEach(doc => {
                sueldosPorNombre[doc.id] = doc.data();
            });
            renderizarSueldos();
        });
        
        db.collection('inflacion').onSnapshot(snapshot => {
            inflacionPorMes = {};
            snapshot.forEach(doc => {
                inflacionPorMes[doc.id] = doc.data().porcentaje;
            });
            renderizarSueldos();
        });

        async function eliminarDocumento(coleccion, id) {
            if (confirm('¿Estás seguro de que deseas eliminar este registro?')) {
                await db.collection(coleccion).doc(id).delete();
            }
        }

        // Funciones para actualizar documentos
        // Estas funciones se mantienen sin cambios
        // (ya están implementadas en los listeners)

    </script>
</body>
</html>