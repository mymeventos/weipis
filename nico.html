<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sueldos y Precios - Nico</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }
        h1, h2, h3 {
            color: #333;
        }
        .container {
            display: grid;
            gap: 20px;
            grid-template-columns: 1fr;
        }
        @media (min-width: 768px) {
            .container {
                grid-template-columns: 1fr 1fr;
            }
        }
        .panel {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .form-section {
            display: none; /* Oculta los botones de agregar en la vista de solo lectura */
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
</head>
<body>

    <h1>Vista de Datos - Nico</h1>
    <div class="container">
        <div class="panel">
            <h2>Gastos de Pastelería</h2>
            <table>
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Monto</th>
                    </tr>
                </thead>
                <tbody id="gastos-list">
                    </tbody>
                <tfoot>
                    <tr>
                        <td style="text-align: right; font-weight: bold;">TOTAL:</td>
                        <td style="font-weight: bold;" id="total-gastos"></td>
                    </tr>
                </tfoot>
            </table>
        </div>

        <div class="panel">
            <h2>Precios de Productos</h2>
            <table>
                <thead>
                    <tr>
                        <th>Producto</th>
                        <th>Precio</th>
                    </tr>
                </thead>
                <tbody id="precios-list">
                    </tbody>
            </table>
        </div>
        
        <div class="panel">
            <h2>Ingresos</h2>
            <table>
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Monto</th>
                    </tr>
                </thead>
                <tbody id="ingresos-list">
                    </tbody>
                <tfoot>
                    <tr>
                        <td style="text-align: right; font-weight: bold;">TOTAL:</td>
                        <td style="font-weight: bold;" id="total-ingresos"></td>
                    </tr>
                </tfoot>
            </table>
        </div>
        
        <div class="panel" id="ventas-pasteleria">
            <h3>Ventas</h3>
            <div class="form-section">
                </div>
            <table>
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Tipo</th>
                        <th>Cantidad</th>
                        <th>Precio Unidad</th>
                        <th>Total Venta</th>
                    </tr>
                </thead>
                <tbody id="ventas-list">
                    </tbody>
                <tfoot>
                    <tr>
                        <td colspan="4" style="text-align: right; font-weight: bold;">TOTAL DEL MES:</td>
                        <td style="font-weight: bold;" id="total-ventas-ventas-pasteleria"></td>
                    </tr>
                </tfoot>
            </table>
        </div>

        <div class="panel">
            <h2>Sueldos</h2>
            <table>
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Sueldo ($)</th>
                        <th>Inflación (%)</th>
                        <th>Sueldo Ajustado ($)</th>
                    </tr>
                </thead>
                <tbody id="sueldos-list">
                    </tbody>
                <tfoot>
                    <tr>
                        <td colspan="3" style="text-align: right; font-weight: bold;">TOTAL:</td>
                        <td style="font-weight: bold;" id="total-sueldos"></td>
                    </tr>
                </tfoot>
            </table>
        </div>
        
        <div class="panel">
            <h2>Inflación</h2>
            <table>
                <thead>
                    <tr>
                        <th>Mes</th>
                        <th>Porcentaje (%)</th>
                    </tr>
                </thead>
                <tbody id="inflacion-list">
                    </tbody>
            </table>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "TU_API_KEY",
            authDomain: "TU_AUTH_DOMAIN",
            projectId: "TU_PROJECT_ID",
            storageBucket: "TU_STORAGE_BUCKET",
            messagingSenderId: "TU_MESSAGING_SENDER_ID",
            appId: "TU_APP_ID"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let sueldosPorNombre = {};
        let inflacionPorMes = {};
        let preciosPasteleriaPorMes = {};

        function formatCurrency(amount) {
            return `$${(amount || 0).toFixed(2)}`;
        }
        
        // --- Funciones para renderizar los datos (sin edición) ---
        
        function renderizarGastos(snapshot) {
            const gastosList = document.getElementById('gastos-list');
            gastosList.innerHTML = '';
            let total = 0;
            snapshot.forEach(doc => {
                const gasto = doc.data();
                const row = document.createElement('tr');
                row.innerHTML = `<td>${gasto.nombre}</td><td>${formatCurrency(gasto.monto)}</td>`;
                gastosList.appendChild(row);
                total += gasto.monto;
            });
            document.getElementById('total-gastos').textContent = formatCurrency(total);
        }

        function renderizarIngresos(snapshot) {
            const ingresosList = document.getElementById('ingresos-list');
            ingresosList.innerHTML = '';
            let total = 0;
            snapshot.forEach(doc => {
                const ingreso = doc.data();
                const row = document.createElement('tr');
                row.innerHTML = `<td>${ingreso.nombre}</td><td>${formatCurrency(ingreso.monto)}</td>`;
                ingresosList.appendChild(row);
                total += ingreso.monto;
            });
            document.getElementById('total-ingresos').textContent = formatCurrency(total);
        }
        
        function renderizarPrecios(snapshot) {
            const preciosList = document.getElementById('precios-list');
            preciosList.innerHTML = '';
            preciosPasteleriaPorMes = {};
            snapshot.forEach(doc => {
                const precio = doc.data();
                preciosPasteleriaPorMes[doc.id] = precio.precio;
                const row = document.createElement('tr');
                row.innerHTML = `<td>${doc.id}</td><td>${formatCurrency(precio.precio)}</td>`;
                preciosList.appendChild(row);
            });
            // Vuelve a renderizar las ventas con los precios actualizados
            db.collection('ventasPasteleria').orderBy('fecha').onSnapshot(ventasSnapshot => {
                const ventas = ventasSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderizarVentas(ventas, preciosPasteleriaPorMes, 'ventas-pasteleria');
            });
        }
        
        function renderizarSueldos() {
            const sueldosList = document.getElementById('sueldos-list');
            sueldosList.innerHTML = '';
            let totalSueldos = 0;
            
            for (const id in sueldosPorNombre) {
                const sueldo = sueldosPorNombre[id];
                const inflacion = inflacionPorMes[sueldo.nombre] || 0;
                const sueldoAjustado = sueldo.monto * (1 + (inflacion / 100));
                totalSueldos += sueldoAjustado;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${sueldo.nombre}</td>
                    <td>${formatCurrency(sueldo.monto)}</td>
                    <td>${inflacion.toFixed(2)}%</td>
                    <td>${formatCurrency(sueldoAjustado)}</td>
                `;
                sueldosList.appendChild(row);
            }
            document.getElementById('total-sueldos').textContent = formatCurrency(totalSueldos);
        }

        function renderizarInflacion() {
            const inflacionList = document.getElementById('inflacion-list');
            inflacionList.innerHTML = '';
            for (const mes in inflacionPorMes) {
                const porcentaje = inflacionPorMes[mes];
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${mes}</td>
                    <td>${porcentaje.toFixed(2)}%</td>
                `;
                inflacionList.appendChild(row);
            }
        }
        
        function renderizarVentas(ventas, precios, containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
        
            container.innerHTML = `
                <h3>Ventas</h3>
                <div class="form-section">
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Tipo</th>
                            <th>Cantidad</th>
                            <th>Precio Unidad</th>
                            <th>Total Venta</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                    <tfoot>
                        <tr>
                            <td colspan="4" style="text-align: right; font-weight: bold;">TOTAL DEL MES:</td>
                            <td style="font-weight: bold;" id="total-ventas-${containerId}"></td>
                        </tr>
                    </tfoot>
                </table>
            `;
        
            const tbody = container.querySelector('tbody');
            let totalMes = 0;
            
            ventas.forEach(venta => {
                const precioDiadeltorta = precios['DIATORTAS'] || 0;
                const precioMesadulce = precios['MESADULCE'] || 0;
        
                if (venta.diatortas > 0) {
                    const row = document.createElement('tr');
                    const total = venta.diatortas * precioDiadeltorta;
                    totalMes += total;
                    row.innerHTML = `
                        <td>${venta.fecha}</td>
                        <td>Día de la Torta</td>
                        <td>${venta.diatortas}</td>
                        <td>${formatCurrency(precioDiadeltorta)}</td>
                        <td>${formatCurrency(total)}</td>
                    `;
                    tbody.appendChild(row);
                }
        
                if (venta.mesadulce > 0) {
                    const row = document.createElement('tr');
                    const total = venta.mesadulce * precioMesadulce;
                    totalMes += total;
                    row.innerHTML = `
                        <td>${venta.fecha}</td>
                        <td>Mesa Dulce</td>
                        <td>${venta.mesadulce}</td>
                        <td>${formatCurrency(precioMesadulce)}</td>
                        <td>${formatCurrency(total)}</td>
                    `;
                    tbody.appendChild(row);
                }
            });
        
            document.getElementById(`total-ventas-${containerId}`).textContent = formatCurrency(totalMes);
        }

        // --- Listeners de Firebase ---
        
        db.collection('gastos').onSnapshot(renderizarGastos);
        db.collection('ingresos').onSnapshot(renderizarIngresos);
        db.collection('preciosPasteleria').onSnapshot(renderizarPrecios);
        
        db.collection('sueldos').onSnapshot(snapshot => {
            sueldosPorNombre = {};
            snapshot.forEach(doc => {
                sueldosPorNombre[doc.id] = doc.data();
            });
            renderizarSueldos();
        });
        
        db.collection('inflacion').onSnapshot(snapshot => {
            inflacionPorMes = {};
            snapshot.forEach(doc => {
                inflacionPorMes[doc.id] = doc.data().porcentaje;
            });
            renderizarSueldos();
        });
        
    </script>
</body>
</html>